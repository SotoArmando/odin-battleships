<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
    <topnav>
        <wrapper>
            <span style="text-align: center;background-color: rgba(0, 0, 0, 0.54);padding:.4rem .5rem;">Pvp</span>
            <span style="text-align: center;background-color: rgba(0, 0, 0, 0.54);padding:.4rem .5rem;">Scores</span>
            <span style="text-align: center;background-color: rgba(0, 0, 0, 0.54);padding:.4rem .5rem;">Reset</span>
            <span style="text-align: center;background-color: rgba(0, 0, 0, 0.54);padding:.4rem .5rem;">Play</span>
            <span style="text-align: center;background-color: rgba(0, 0, 0, 0.54);padding:.4rem .5rem;">Setup your
                chips!</span>

        </wrapper>
    </topnav>
    <page class="active battleships-container">
        <wrapper>
            <board>
                <span style="margin-left:20px;"><span style="font-weight: 600;">Board - Player 1</span><br />Wait for
                    the other player</span>
                <cells data-playerid="0" style="margin-bottom: 1rem;margin-top: 1rem;">
                    <item data-id='0'></item>
                    <item data-id='1'></item>
                    <item data-id='2'></item>
                    <item data-id='3'></item>
                    <item data-id='4'></item>
                    <item data-id='5'></item>
                    <item data-id='6'></item>
                    <item data-id='7'></item>
                    <item data-id='8'></item>
                    <item data-id='9'></item>
                    <item data-id='10'></item>
                    <item data-id='11'></item>
                    <item data-id='12'></item>
                    <item data-id='13'></item>
                    <item data-id='14'></item>
                    <item data-id='15'></item>
                    <item data-id='16'></item>
                    <item data-id='17'></item>
                    <item data-id='18'></item>
                    <item data-id='19'></item>
                    <item data-id='20'></item>
                    <item data-id='21'></item>
                    <item data-id='22'></item>
                    <item data-id='23'></item>
                    <item data-id='24'></item>
                    <item data-id='25'></item>
                    <item data-id='26'></item>
                    <item data-id='27'></item>
                    <item data-id='28'></item>
                    <item data-id='29'></item>
                    <item data-id='30'></item>
                    <item data-id='31'></item>
                    <item data-id='32'></item>
                    <item data-id='33'></item>
                    <item data-id='34'></item>
                    <item data-id='35'></item>
                    <item data-id='36'></item>
                    <item data-id='37'></item>
                    <item data-id='38'></item>
                    <item data-id='39'></item>
                    <item data-id='40'></item>
                    <item data-id='41'></item>
                    <item data-id='42'></item>
                    <item data-id='43'></item>
                    <item data-id='44'></item>
                    <item data-id='45'></item>
                    <item data-id='46'></item>
                    <item data-id='47'></item>
                    <item data-id='48'></item>
                    <item data-id='49'></item>
                    <item data-id='50'></item>
                    <item data-id='51'></item>
                    <item data-id='52'></item>
                    <item data-id='53'></item>
                    <item data-id='54'></item>
                    <item data-id='55'></item>
                    <item data-id='56'></item>
                    <item data-id='57'></item>
                    <item data-id='58'></item>
                    <item data-id='59'></item>
                    <item data-id='60'></item>
                    <item data-id='61'></item>
                    <item data-id='62'></item>
                    <item data-id='63'></item>
                    <item data-id='64'></item>
                    <item data-id='65'></item>
                    <item data-id='66'></item>
                    <item data-id='67'></item>
                    <item data-id='68'></item>
                    <item data-id='69'></item>
                    <item data-id='70'></item>
                    <item data-id='71'></item>
                    <item data-id='72'></item>
                    <item data-id='73'></item>
                    <item data-id='74'></item>
                    <item data-id='75'></item>
                    <item data-id='76'></item>
                    <item data-id='77'></item>
                    <item data-id='78'></item>
                    <item data-id='79'></item>
                    <item data-id='80'></item>
                    <item data-id='81'></item>
                    <item data-id='82'></item>
                    <item data-id='83'></item>
                    <item data-id='84'></item>
                    <item data-id='85'></item>
                    <item data-id='86'></item>
                    <item data-id='87'></item>
                    <item data-id='88'></item>
                    <item data-id='89'></item>
                    <item data-id='90'></item>
                    <item data-id='91'></item>
                    <item data-id='92'></item>
                    <item data-id='93'></item>
                    <item data-id='94'></item>
                    <item data-id='95'></item>
                    <item data-id='96'></item>
                    <item data-id='97'></item>
                    <item data-id='98'></item>
                    <item data-id='99'></item>
                </cells>
                <span style="text-align: center;font-size: 3.574462890625em;">0</span>
            </board>
            <space style="width:2rem;"></space>
            <board>
                <span style="margin-left:20px;"><span style="font-weight: 600;">Board - Player 2</span><br />Wait for
                    the other player</span>
                <cells data-playerid="1" style="margin-bottom: 1rem;margin-top: 1rem;">
                    <item data-id='0'></item>
                    <item data-id='1'></item>
                    <item data-id='2'></item>
                    <item data-id='3'></item>
                    <item data-id='4'></item>
                    <item data-id='5'></item>
                    <item data-id='6'></item>
                    <item data-id='7'></item>
                    <item data-id='8'></item>
                    <item data-id='9'></item>
                    <item data-id='10'></item>
                    <item data-id='11'></item>
                    <item data-id='12'></item>
                    <item data-id='13'></item>
                    <item data-id='14'></item>
                    <item data-id='15'></item>
                    <item data-id='16'></item>
                    <item data-id='17'></item>
                    <item data-id='18'></item>
                    <item data-id='19'></item>
                    <item data-id='20'></item>
                    <item data-id='21'></item>
                    <item data-id='22'></item>
                    <item data-id='23'></item>
                    <item data-id='24'></item>
                    <item data-id='25'></item>
                    <item data-id='26'></item>
                    <item data-id='27'></item>
                    <item data-id='28'></item>
                    <item data-id='29'></item>
                    <item data-id='30'></item>
                    <item data-id='31'></item>
                    <item data-id='32'></item>
                    <item data-id='33'></item>
                    <item data-id='34'></item>
                    <item data-id='35'></item>
                    <item data-id='36'></item>
                    <item data-id='37'></item>
                    <item data-id='38'></item>
                    <item data-id='39'></item>
                    <item data-id='40'></item>
                    <item data-id='41'></item>
                    <item data-id='42'></item>
                    <item data-id='43'></item>
                    <item data-id='44'></item>
                    <item data-id='45'></item>
                    <item data-id='46'></item>
                    <item data-id='47'></item>
                    <item data-id='48'></item>
                    <item data-id='49'></item>
                    <item data-id='50'></item>
                    <item data-id='51'></item>
                    <item data-id='52'></item>
                    <item data-id='53'></item>
                    <item data-id='54'></item>
                    <item data-id='55'></item>
                    <item data-id='56'></item>
                    <item data-id='57'></item>
                    <item data-id='58'></item>
                    <item data-id='59'></item>
                    <item data-id='60'></item>
                    <item data-id='61'></item>
                    <item data-id='62'></item>
                    <item data-id='63'></item>
                    <item data-id='64'></item>
                    <item data-id='65'></item>
                    <item data-id='66'></item>
                    <item data-id='67'></item>
                    <item data-id='68'></item>
                    <item data-id='69'></item>
                    <item data-id='70'></item>
                    <item data-id='71'></item>
                    <item data-id='72'></item>
                    <item data-id='73'></item>
                    <item data-id='74'></item>
                    <item data-id='75'></item>
                    <item data-id='76'></item>
                    <item data-id='77'></item>
                    <item data-id='78'></item>
                    <item data-id='79'></item>
                    <item data-id='80'></item>
                    <item data-id='81'></item>
                    <item data-id='82'></item>
                    <item data-id='83'></item>
                    <item data-id='84'></item>
                    <item data-id='85'></item>
                    <item data-id='86'></item>
                    <item data-id='87'></item>
                    <item data-id='88'></item>
                    <item data-id='89'></item>
                    <item data-id='90'></item>
                    <item data-id='91'></item>
                    <item data-id='92'></item>
                    <item data-id='93'></item>
                    <item data-id='94'></item>
                    <item data-id='95'></item>
                    <item data-id='96'></item>
                    <item data-id='97'></item>
                    <item data-id='98'></item>
                    <item data-id='99'></item>
                </cells>
                <span style="text-align: center;font-size: 3.574462890625em;">0</span>
            </board>
        </wrapper>
    </page>
</body>
<script src="index.js"></script>
<script>



    function positionCalculator(position = 0, data) {
        return {
            position,
            goLeft: function (number) {
                let error = undefined;
                error = (number > 98 || number < 2) ? 'There is no more board to do that' : undefined
                if (error) {
                    return error;
                } else {
                    this.position -= 1;
                    return (this.position);
                }
            },
            goRight: function (number) {
                let error = undefined;
                error = (number > 98 || number < 2) ? 'There is no more board to do that' : undefined
                if (error) {
                    return error;
                } else {
                    this.position += 1;
                    return (this.position);
                }
            },
            goUp: function (number) {
                let error = undefined;
                error = (number > 89) ? 'There is no more board to do that' : undefined
                if (error) {
                    return error;
                } else {
                    this.position += 10;
                    return (this.position);
                }
            },
            goDown: function (number) {
                let error = undefined;
                error = (number < 10) ? 'There is no more board to do that' : undefined
                if (error) {
                    return error;
                } else {
                    this.position -= 10;
                    return (this.position);
                }
            },
            isSomethingThere: function (vertex, size) {

                let yes = false;
                this.position = vertex.position;
                let positions = []
                let positionbi = positionIn(vertex.position)

                switch (vertex.direction) {
                    case 0:
                        if (positionbi.y + size > 7) {
                            return true;
                        }
                        break;
                    case 1:
                        if (positionbi.x + size > 7) {
                            return true;
                        }
                        break;
                    case 2:
                        if (positionbi.y - size < 1) {
                            return true;
                        }
                        break;
                    case 3:
                        if (positionbi.x - size < 1) {
                            return true;
                        }
                        break;
                }

                for (let i = 0; i < size; i++) {
                    console.log(yes, vertex.position, size, data[this.position]);
                    positions.push(this.position)

                    switch (vertex.direction) {
                        case 0:
                            yes = (data[this.position]) ? true : yes;
                            this.goUp()
                            break;
                        case 1:
                            yes = (data[this.position]) ? true : yes;
                            this.goRight()
                            break;
                        case 2:
                            yes = (data[this.position]) ? true : yes;
                            this.goDown()
                            break;
                        case 3:
                            yes = (data[this.position]) ? true : yes;
                            this.goLeft()
                            break;
                    }
                }

                if (!yes) {
                    positions.forEach(position => { data[position] = true; });
                }

                return yes;
            },
            allpositions: function (vertex, size) {
                this.position = vertex.position;
                let positions = []


                for (let i = 0; i < size; i++) {
                    positions.push(this.position)
                    switch (vertex.direction) {
                        case 0:
                            this.goUp()
                            break;
                        case 1:
                            this.goRight()
                            break;
                        case 2:
                            this.goDown()
                            break;
                        case 3:
                            this.goLeft()
                            break;
                    }
                }
                return positions;
            }
        }
    }

    function positionIn(x) {
        let rows = 10;
        let columns = 10;
        let xismorethanonerow = (x > columns);
        if (xismorethanonerow) {
            return { x: x % columns, y: Math.floor(x / rows) }
        } else {
            return { x, y: 0 };
        }
    }

    function positionOut({ x, y }) {
        let rows = 10;
        let columns = 10;
        return ((y * rows) + x);
    }

    function ship({ size, position, direction }) {
        return {
            lives: size,
            size,
            vertex: { position, direction },
            takedown: function () {
                error = undefined;
                error = (this.lives == 0) ? 'This ship is gone and the cell is marked' : undefined;
                if (error) {
                    return error;
                } else {
                    this.lives -= 1;
                }
            }
        }
    }

    function player(index, data = [...(" ".repeat(100).split("").map(function (value) { return false }))], strikes = [...(" ".repeat(100).split("").map(function (value) { return false }))]) {
        return {
            data,
            strikes,
            index,
            renderer: render(),
            chips: [2, 3, 4, 4, 2, 2, 3, 6].map(function (size) {
                let thisship = undefined;
                if (!this.renderer) { this.renderer = render(); }
                if (!this.data) { this.data = data }
                if (!this.strikes) { this.strikes = strikes }

                while (true) {
                    let position = Math.floor(Math.random() * 99);
                    let direction = Math.floor(Math.random() * 4);

                    if (!positionCalculator(0, this.data).isSomethingThere({ position, direction }, size)) {

                        thisship = ship({ size, position, direction })
                        break;
                    }
                }


                this.renderer.addShip(index, positionCalculator(0, this.data).allpositions(thisship.vertex, thisship.size), thisship.vertex, thisship.size);
                return thisship;

            }),
            strike: function (position) {
                let error = undefined;
                if (!this.renderer) { this.renderer = render(); }
                if (!this.data) { this.data = data }
                if (!this.strikes) { this.strikes = strikes }

                error = (data[position] == true) ? 'Try again. that cell is already marked' : undefined;
                if (error) { return error }
                else {
                    this.data[position] = true;
                }
                this.renderer.strikePosition(position, (this.index == 1) ? 0 : 1)
            },

        }
    }

    function board() {
        return {
            players: [player(0), player(1)],
            showWinner: function (player) {
                return `There is awinner ${player}`
            },
        }
    }

    function render() {
        let initialized = false;
        function openShipMove(playerindex, vertex, size) {

            let elementsArray = document.querySelectorAll(`cells[data-playerid='${playerindex}'] > item`);
            if (initialized) {
                elementsArray.forEach(function (elem) {
                    elem.classList.remove('opened')
                    elem.setAttribute('data-size', size)
                    elem.setAttribute('data-playerindex', playerindex)
                    elem.setAttribute('data-direction', vertex.direction)

                });
            } else {
                elementsArray.forEach(function (elem) {

                    elem.setAttribute('data-size', size)
                    elem.setAttribute('data-playerindex', playerindex)
                    elem.setAttribute('data-direction', vertex.direction)

                    elem.addEventListener("mouseenter", function () {
                        let descicions = positionCalculator(parseInt(elem.getAttribute('data-id')));
                        let hoveredArray = document.querySelectorAll(`cells[data-playerid='${elem.getAttribute('data-playerindex')}'] > item`);
                        let positions = []
                        console.log(elem.getAttribute('data-size'),elem.getAttribute('data-playerindex'),elem.getAttribute('data-direction'))
                        for (let i = 0; i < elem.getAttribute('data-size'); i++) {
                            document.querySelector(`cells[data-playerid='${elem.getAttribute('data-playerindex')}'] > item[data-id='${descicions.position}']`).classList.add('opened')
                            switch (parseInt(elem.getAttribute('data-direction'))) {
                                case 0:
                                    descicions.goUp()
                                    break;
                                case 1:
                                    descicions.goRight()
                                    break;
                                case 2:
                                    descicions.goDown()
                                    break;
                                case 3:
                                    descicions.goLeft()
                                    break;
                            }

                        }
                        
                        console.log(positions)
                    });

                    elem.addEventListener("mouseleave", function () {
                        let descicions = positionCalculator(parseInt(elem.getAttribute('data-id')));
                        let hoveredArray = document.querySelectorAll(`cells[data-playerid='${elem.getAttribute('data-playerindex')}'] > item`);
                        let positions = []
                        for (let i = 0; i < elem.getAttribute('data-size'); i++) {
                            positions.push(descicions.position);
                            document.querySelector(`cells[data-playerid='${elem.getAttribute('data-playerindex')}'] > item[data-id='${descicions.position}']`).classList.remove('opened')
                            switch (parseInt(elem.getAttribute('data-direction'))) {
                                case 0:
                                    descicions.goUp()
                                    break;
                                case 1:
                                    descicions.goRight()
                                    break;
                                case 2:
                                    descicions.goDown()
                                    break;
                                case 3:
                                    descicions.goLeft()
                                    break;
                            }

                        }
                        
                        console.log(positions)
                    });

                    initialized = true;
                });

            }

            initialized = true;
        }



        return {
            cleanBoard: function (index = 0) {

            },
            addShip: function (playerindex, allpositions, vertex, size) {
                debugger;

                let color = `rgba(${(Math.random() * 255)},${(Math.random() * 255)},${(Math.random() * 255)},0.3)`;
                console.log(color);
                allpositions.forEach(function (position) {


                    document.querySelector(`cells[data-playerid='${playerindex}'] > item[data-id='${position}']`).classList.toggle('active');
                    document.querySelector(`cells[data-playerid='${playerindex}'] > item[data-id='${position}']`).style.backgroundColor = color;

                    document.querySelector(`cells[data-playerid='${playerindex}'] > item[data-id='${position}']`).addEventListener("click", function (listener) {
                        debugger;
                        openShipMove(playerindex, vertex, size);
                    })
                })
            },

            strikePosition: function (playerindex, position) {
                document.querySelector(`cells[data-playerid='${playerindex}'] > item[data-id='${position}']`).classList.remove('active');
                document.querySelector(`cells[data-playerid='${playerindex}'] > item[data-id='${position}']`).classList.add('striked');
            },
        };
    }

    function app() {
        return {
            initGame: function () {
                let thisboard = board();

            }
        }
    }

    app().initGame();
</script>

</html>